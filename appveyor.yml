
version: 1.0.{build}
configuration: Debug
platform: x64
image:
  - macos
  - Visual Studio 2019
  - Visual Studio 2015

for:
  -
    matrix:
      only:
        - image: macos
        - image: macos-bigsur

    build_script:
      - mkdir build_dicomhero_debug
      - mkdir build_dicomhero_ios_debug
      - cd build_dicomhero_debug
      - cmake -GXcode -DCMAKE_BUILD_TYPE=Debug ..
      - cmake --build . --config Debug
      - ctest -V .
      - cd ../build_dicomhero_ios_debug
      - cmake -GXcode -DCMAKE_SYSTEM_NAME=iOS -DCMAKE_BUILD_TYPE=Release ..
      - cmake --build . --config Release
      - cmake --build . --config Release -- -sdk iphonesimulator
      - cd ..
      - cp -R dicomheroCore6/library/include build_dicomhero_debug
      - cp -R dicomheroCore6/library/include build_dicomhero_ios_debug

    artifacts:
      - path: build_dicomhero_debug/*.dylib
        name: dicomhero_macos_debug
      - path: build_dicomhero_ios_debug/*.a
        name: dicomhero_ios_debug

  -
    matrix:
      only:
        - image: Visual Studio 2015

    build_script:
      - cmd: >-

          mkdir build_dicomhero_release

          cd build_dicomhero_release
    
          cmake -DCMAKE_BUILD_TYPE=Release ..
    
          cmake --build . --config Release

          ctest -V .

          cd ..

          mkdir build_dicomhero_release\Release\include
    
          mkdir build_dicomhero_debug\Debug\include

          xcopy dicomheroCore6\library\include build_dicomhero_release\Release\include /s /e

          xcopy dicomheroCore6\library\include build_dicomhero_debug\Debug\include /s /e

    artifacts:
      - path: build_dicomhero_release/Release
        name: dicomhero__vs2015_release

build_script:
- cmd: >-

    mkdir build_dicomhero_release

    mkdir build_dicomhero_debug

    cd build_dicomhero_release
    
    cmake -DCMAKE_BUILD_TYPE=Release ..
    
    cmake --build . --config Release

    ctest -V .

    cd ../build_dicomhero_debug
    
    cmake -DCMAKE_BUILD_TYPE=Debug ..
    
    cmake --build . --config Debug

    cd ..

    mkdir build_dicomhero_release\Release\include
    
    mkdir build_dicomhero_debug\Debug\include

    xcopy dicomheroCore6\library\include build_dicomhero_release\Release\include /s /e

    xcopy dicomheroCore6\library\include build_dicomhero_debug\Debug\include /s /e

test_script:
- cmd: 
artifacts:
- path: build_dicomhero_release/Release
  name: dicomhero_vs2019_release
- path: build_dicomhero_debug/Debug
  name: dicomhero_vs2019_debug
